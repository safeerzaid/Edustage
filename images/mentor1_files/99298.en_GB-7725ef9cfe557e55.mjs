(self.modernJsonp=self.modernJsonp||[]).push([["99298"],{935850(e,t,a){var s;a.r(t),a.d(t,{default:()=>o});let i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PinSaveRequest_pin",selections:[{alias:"images_orig",args:[{kind:"Literal",name:"spec",value:"orig"}],concreteType:"ImageDetails",kind:"LinkedField",name:"images",plural:!1,selections:s=[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:'images(spec:"orig")'},{alias:"images_236x",args:[{kind:"Literal",name:"spec",value:"236x"}],concreteType:"ImageDetails",kind:"LinkedField",name:"images",plural:!1,selections:s,storageKey:'images(spec:"236x")'},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entityId",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isPromoted",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"promotedIsRemovable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"trackingParams",storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"imageUrl",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"imageBase64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mediaUploadId",storageKey:null}]}],type:"Pin",abstractKey:null};i.hash="64132b88edd48497e63c9ad85ae5ab66";let o=i},583215(e,t,a){a.r(t),a.d(t,{default:()=>i});let s={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PinSaveRequest_shuffle_asset",selections:[{alias:null,args:null,kind:"ScalarField",name:"entityId",storageKey:null}],type:"ShuffleAsset",abstractKey:null};s.hash="58c24e25a76e7a1c4533f3b07f490517";let i=s},363508(e,t,a){a.d(t,{A:()=>C});var s=a(97407),i=a(296540),o=a(236507),n=a(498653),l=a(443715),r=a(403532),d=a(305167),c=a(474848);function u({anchorRef:e,board:t,onBoardSelect:a,onDismiss:u,popoverId:p,urlPinInfo:_}){(0,i.useEffect)(()=>{(0,s.A)("BoardPicker","/app/common/react/components/Lens/Save/BoardPicker.tsx")},[]);let[h,m]=(0,i.useState)(!1),[v,f]=(0,i.useState)(""),g=(0,i.useCallback)(e=>{let{id:t,name:s,url:i}=e;a({id:t,name:s,url:i}),u()},[a,u]),S=(0,i.useCallback)(e=>{if(!e.boardId)return;let{boardId:t,title:s,url:i}=e;a({id:t,name:s??void 0,url:i??void 0}),u()},[a,u]),b=(0,i.useCallback)(e=>{f(e?.title??""),m(!0)},[]),P=(0,i.useCallback)(()=>{m(!1),u()},[u]);return(0,c.jsx)(o.Wd,{zIndex:new o.K5([n.B4]),children:h?(0,c.jsx)(r.A,{boardCreateSource:"board_picker",images:[{url:_.imageUrl,name:""}],initialValues:{boardName:v},onBoardCreate:g,onClose:P}):(0,c.jsx)(o.AM,{anchor:e.current,id:p,idealDirection:"down",onDismiss:u,positionRelativeToAnchor:!1,size:"xl",children:(0,c.jsx)(l.A,{children:(0,c.jsx)(d.cC,{displayShortlistMostRecentBoard:!0,onBoardCreate:b,onItemChosen:S,selectedItem:t,showCreateBoardButton:!0,showFlyoutSaveButton:!1,showSaveToProfile:!0})})})})}var p=a(526607),_=a(901856),h=a(55268),m=a(643357),v=a(211974),f=a(443400),g=a(671468),S=a(871211),b=a(62923);function P({board:e,onSaveComplete:t,urlPinInfo:a}){return(0,i.useEffect)(()=>{(0,s.A)("SaveHandler","/app/common/react/components/Lens/Save/SaveHandler.tsx")},[]),(0,c.jsx)(b.a,{action:"create",description:"",method:"lens",pinKey:null,setCompletionPromise:t,shuffleAssetKey:null,urlPinInfo:a,children:({handleSaveToBoard:t})=>(0,c.jsx)(y,{board:e,handleSaveToBoard:t})})}function y({board:e,handleSaveToBoard:t}){return(0,S.A)(()=>{t({...e,type:"board"})}),null}var A=a(340577);function C({imageUrl:e,saveButtonOnly:t=!1}){(0,i.useEffect)(()=>{(0,s.A)("LensBetterSave","/app/common/react/components/Lens/Save/LensBetterSave.tsx")},[]);let a=(0,i.useId)(),n=(0,i.useRef)(null),l=(0,i.useRef)(null),r=t?n:l,[d,S]=(0,i.useState)(!1),{isSaved:b,board:y,urlPinInfo:C,saveImageToBoard:w,handleUnsave:x,renderPendingSave:k}=function({imageUrl:e}){let t={description:"",imageUrl:e,link:""},a=function(){let e=(0,g.d4)(e=>e.mostRecentBoard);if(e)return{id:e.id,name:e.name,url:e.url}}(),{isSaved:s,savedBoard:o,handleBoardSaveComplete:n,handleUnsave:l,setOptimisticSave:r}=function({imageUrl:e}){let t=(0,m.A)(),a=(0,v.CG)(),{getSavedImageState:s,setSavedImageState:o,clearSavedImageState:n}=(0,p.S)(),l=s(e),[r,d]=(0,i.useState)(!!l),[u,g]=(0,i.useState)(l?.pinId??null),[S,b]=(0,i.useState)(l?.board),P=(0,i.useCallback)(async(s,i)=>{await (0,_.A)({url:"/v3/pins/{pin}/",urlParams:{pin:s},method:"DELETE"}),d(!1),g(null),b(void 0),n(e);let o=i?t.bt("Removed from your board.", "Removed from your board!", "LensBetterSave.RemovedFromBoard", undefined, true):t.bt("Pin removed.", "Pin removed!", "LensBetterSave.PinRemoved", undefined, true);a.showToast(({hideToast:e})=>(0,c.jsx)(h.A,{dataTestId:"lens-better-save-removed-toast",onHide:e,text:o}))},[n,t,e,a]),y=(0,i.useCallback)(async()=>{u&&await P(u,!!S?.id)},[u,S?.id,P]),A=(0,i.useCallback)(e=>{d(!0),b(e)},[]);return{isSaved:r,savedBoard:S,handleBoardSaveComplete:(0,i.useCallback)(async t=>{let{id:s,board:i}=await t.promise,{id:n,name:l,url:r}=i,u={id:n,name:l,url:r};d(!0),g(s),b(u),o(e,{pinId:s,board:u}),a.showToast(({hideToast:t})=>(0,c.jsx)(f.A,{boardName:l,boardUrl:r,onHide:t,onUndo:async()=>{t(),await P(s,!!n)},pinImageUrl:e}))},[e,o,a,P]),handleUnsave:y,setOptimisticSave:A}}({imageUrl:e}),{setPendingBoard:d,renderPendingSave:u}=function({urlPinInfo:e,onBoardSaveComplete:t}){let[a,s]=(0,i.useState)(null),o=(0,i.useCallback)(()=>a?(0,c.jsx)(P,{board:a,onSaveComplete:async e=>{await t(e),s(null)},urlPinInfo:e}):null,[a,t,e]);return{setPendingBoard:s,renderPendingSave:o}}({urlPinInfo:t,onBoardSaveComplete:n});return{isSaved:s,board:o??a,urlPinInfo:t,saveImageToBoard:(0,i.useCallback)(e=>{r(e),d(e)},[r,d]),handleUnsave:l,renderPendingSave:u}}({imageUrl:e}),I=(0,i.useCallback)(e=>{(e.stopPropagation(),t&&b)?x():S(e=>!e)},[t,b,x]),E=(0,i.useCallback)(async e=>{(e.stopPropagation(),b)?x():!y?.id||t?S(!0):w(y)},[y,t,b,x,w]);return(0,c.jsxs)(o.az,{ref:n,"data-test-id":"lens-better-save",width:"100%",children:[(0,c.jsx)(A.A,{accessibilityControls:a,accessibilityExpanded:d,accessibilityHaspopup:!0,dropdownRef:l,hideDropdown:t,isSaved:b,onBoardDropdownClick:I,onSaveClick:E,promotedIsLeadAd:!1,selectedTitle:y?.name,showBoardFlyout:d,unselectedText:"Select",view:"pin"}),d&&(0,c.jsx)(u,{anchorRef:r,board:y,onBoardSelect:w,onDismiss:()=>S(!1),popoverId:a,urlPinInfo:C}),k()]})}},498653(e,t,a){a.d(t,{B4:()=>_,CR:()=>c,Dj:()=>S,Et:()=>f,Gj:()=>r,J8:()=>p,SY:()=>d,UQ:()=>b,WK:()=>v,YU:()=>n,cr:()=>P,g0:()=>m,jr:()=>y,nb:()=>h,qm:()=>u,rm:()=>l,tF:()=>g});var s=a(236507),i=a(643357),o=a(151274);let n="/v3/visual_search/lens/history/",l=119,r=4054,d=15075,c=119,u=150,p=540,_=new s.K5([o.Bf]),h="CAMERA_GALLERY",m="image/jpeg",v=".jpg",f=.8,g="unsupportedFormat",S=1200,b="/v3/visual_search/lens/upload/",P="IMAGE_URL",y=()=>(0,i.A)()._("Something went wrong. Please try again","lens.error.uploadFailed","Error message when file upload fails unexpectedly")},150403(e,t,a){a.d(t,{A:()=>n});var s=a(221077);let i=/^\/pin\/(.*[^\/])\/$/,o={"/":"feed_home","/homefeed":"feed_home","/pin/:id":"pin","/pin/:id/comments":"pin","/pin/:id/activity/tried":"pin","/pin/:id/activity/comments":"pin","/pin/:id/visual-search":"flashlight","/discover/article/:id":"explore_article","/discover/article/:title/:id":"explore_article","/topics/:interest":"feed_interest","/categories/:interest":"feed_category","/news_hub/:id":"notifications","/explore/:interest":"seo_auth","/interest/:id":"seo_auth","/search/:scope":"search","/following":"feed_following","/color-seasons/":"seasons","/:username/pins":"user_pins","/:username/tried":"user_tries","/:username/:slug":"board","/:username/:slug/edit":"board","/:username/:slug/invite":"board","/:username/:slug/:section_slug":"board","/story_feed":"shop_feed"};function n(e,t){let a=["pin"],n=[],l=1,r="unknown",d="unknown",c=!0;for(let t=e.length-1;t>0;t-=1){let i=function(e,t){if(t<=0)return"unknown";let a=e[t-1],i=a?.matchedPath||"",n=["stela","stl"].includes((0,s.A)(a?.location?.search).surfaceType??"");if(i&&"/pin/:id/visual-search"===i&&n)return"shop_feed";let l=i in o?o[i]:"unknown";return i?l:"feed_home"}(e,t);a.splice(0,0,i),c&&("pin"===(r=i)?l+=1:c=!1)}for(let t=e.length-2;t>=0;t-=1){let a=(e[t]?.location?.pathname||"").match(i);if(a&&2===a.length)n.splice(0,0,a[1].split("/")[0]);else break}return 1===a.length?(d="deep_linking",r="deep_linking"):(d=a[a.length-2],"pin"===r&&(r="deep_linking")),"seo_auth"!==d||t||(d="seo_unauth"),"seo_auth"!==r||t||(r="seo_unauth"),("search"===d||"search"===r)&&e.length>=l+1&&"/search/buyable_pins/"===(e[e.length-l-1]?.location?.pathname||"")&&(r="shop_feed","search"===d&&(d="shop_feed")),{trafficSource:d,topLevelTrafficSource:r,topLevelTrafficSourceDepth:l,contextPinIds:n}}},870637(e,t,a){a.d(t,{A:()=>d,r:()=>r});var s=a(296540),i=a(275552),o=a(869344),n=a(556596),l=a(534955);function r(e,t){let{setViewContextData:a}=(0,o.x)(),{requestIdentifier:r}=(0,l._8)(),d=(0,i.A)(),{viewData:c}=(0,o.WQ)();(0,s.useEffect)(()=>{e&&(a({viewType:e.view_type??1,viewParameter:e.view_parameter,viewData:e.view_data?(0,n.A)(c,e.view_data):c,component:e.component,element:e.element,objectIdStr:e.object_id_str,auxData:e.aux_data,clientTrackingParams:e.clientTrackingParams}),d({...e,event_type:13,request_identifier:r}))},[t])}function d(e){let{children:t,log:a}=e;return r(a),t||null}},219843(e,t,a){a.d(t,{A:()=>s});function s(e,t){if(!t)return e;let a=new RegExp(/http(s?):/);if(!a.test(e)){let s=a.exec(t);s&&s.length&&(e=s[0]+e)}return e}},588628(e,t,a){a.d(t,{A:()=>n,e:()=>o});var s=a(296540);let i=()=>{let[e,t]=(0,s.useState)(!1),[a,i]=(0,s.useState)(!1),[o,n]=(0,s.useState)(!1);return{active:e,focused:a,hovered:o,onBlur:()=>{i(!1),t(!1)},onFocus:()=>i(!0),onMouseDown:()=>t(!0),onMouseEnter:()=>n(!0),onMouseLeave:()=>{n(!1),t(!1)},onMouseUp:()=>t(!1)}};function o({children:e}){return e(i())}let n=i},582301(e,t,a){a.d(t,{P:()=>s,y:()=>i});let{Provider:s,getMaybe:i}=(0,a(697384).A)("PinCreateDeleteContext")},243042(e,t,a){a.d(t,{_G:()=>c,oh:()=>d});var s=a(97407),i=a(296540),o=a(532189),n=a(474848);let l={showCloseupContentRight:!0,showProductDetailPage:!1,viewportSize:"lg",paneWidth:o.qr,maxWidth:o.QH,descriptionPaneWidth:o.QH-o.qr,isCommentAttachmentSelectorOpen:!1,isCommentComposerFocused:!1,isCommentPopoverInteractionActive:!1,isCommentThreadExpanded:!1,isCloseupMediaViewerOpen:!1,isMediaViewerOpen:!1,isShoppingModuleExpanded:!1,closeupWithinMasonryEnabled:!1,peekCloseupEnabled:!1,calculatedImageHeight:0,setAbortNoActionPlacementTimeout:()=>{},setIsCloseupMediaViewerOpen:()=>{},setIsCommentAttachmentSelectorOpen:()=>{},setIsCommentComposerFocused:()=>{},setIsCommentPopoverInteractionActive:()=>{},setIsMediaViewerOpen:()=>{},setIsShoppingModuleExpanded:()=>{},setCalculatedImageHeight:()=>{},setViewportSize:()=>{}},r=(0,i.createContext)(l);function d({children:e,value:t}){(0,i.useEffect)(()=>{(0,s.A)("Context","/app/www/closeup/desktop/Context.tsx")},[]);let a=(0,i.useMemo)(()=>({...l,...t}),[t]);return(0,n.jsx)(r,{value:a,children:e})}function c(){let e=(0,i.use)(r);if(!e)throw Error("useCloseupContext must be used within CloseupContextProvider");return e}},532189(e,t,a){a.d(t,{DG:()=>l,Em:()=>g,En:()=>b,Ii:()=>y,M1:()=>p,MI:()=>f,QH:()=>o,Ye:()=>c,Z:()=>_,bZ:()=>h,bo:()=>n,gr:()=>P,h3:()=>d,n0:()=>u,nb:()=>m,qr:()=>i,t4:()=>A,tb:()=>r,vg:()=>v,w$:()=>S});var s=a(236507);let i=508,o=1016,n=488,l=992,r=672,d=1176,c=40,u=72,p=740,_=32,h=16,m=24,v=2,f=1,g=new s.rk(5),S={ARTICLE:"https://schema.org/Article",BRAND:"https://schema.org/Brand",PRODUCT:"https://schema.org/Product",RECIPE:"https://schema.org/Recipe",OFFER:"https://schema.org/Offer",OUT_OF_STOCK:"https://schema.org/OutOfStock",PERSON:"https://schema.org/Person"},b={boxShadow:"0 2px 5px rgba(0, 0, 0, 0.06)",transition:"box-shadow 200ms ease-in-out"},P="calc(90vh - 80px)",y="calc(55vh + 80px)",A="calc(75vh - 80px)"},340577(e,t,a){a.d(t,{A:()=>c});var s=a(97407),i=a(296540),o=a(236507),n=a(643357),l=a(327467),r=a(243042),d=a(474848);function c({accessibilityControls:e,accessibilityExpanded:t,accessibilityHaspopup:a,dropdownRef:c,hideDropdown:u=!1,isSaved:p,onBoardDropdownClick:_,onSaveClick:h,promotedIsLeadAd:m,renderPinSaveTooltip:v,selectedTitle:f,showBoardFlyout:g,unselectedText:S,view:b,surface:P}){(0,i.useEffect)(()=>{(0,s.A)("BoardSelectionDisplay","/app/www/common/PinBetterSave/BoardSelectionDisplay.tsx")},[]);let[y,A]=(0,i.useState)(!1),C=(0,n.A)(),w=(0,i.useRef)(null),{closeupWithinMasonryEnabled:x}=(0,r._G)();(0,i.useEffect)(()=>{y&&A(!1)},[y]);let k=f||S,I="closeup"===b,E="media-viewer"===b,T="comparison"===b,B="VideoCarouselModule"===P,R=(0,i.useMemo)(()=>T?"inverse":E?g?"inverse":"default":g||!I?"inverse":"default",[I,g,E,T]),z=(0,i.useCallback)(({event:e})=>{_(e)},[_]),D=I?"transparent":"transparentInverse";D=E?"tertiarySemiTransparent":D,D=T?"transparentInverse":D;let j=p?C.bt("Saved", "Saved", "PinBetterSave.BoardSelection.SavedButton", undefined, true):C.bt("Save", "Save", "PinBetterSave.BoardSelection.SaveButton", undefined, true);return(0,d.jsxs)(o.az,{alignItems:E?"start":"center",dangerouslySetInlineStyle:{__style:{gap:"4px"}},display:"flex",paddingX:x?0:void 0,width:"100%",children:[!u&&(0,d.jsx)(o.az,{"data-test-id":f?"board-selection-item-selected":"board-selection-placeholder",flex:"grow",width:"100%",children:(0,d.jsx)(o.$n,{ref:c,accessibilityControls:e,accessibilityExpanded:t,accessibilityHaspopup:a,accessibilityLabel:(0,l.$)(C.bt("Select a board to save to: {{ boardName }}", "Select a board to save to: {{ boardName }}", "PinBetterSave.BoardSelection.DropdownIcon", undefined, true),{boardName:k}),color:D,dataTestId:"PinBetterSaveDropdown",iconEnd:"chevron-down",onClick:z,selected:g,size:B?"sm":"lg",text:(0,d.jsx)(o.KJ,{color:R,lineClamp:1,overflow:"breakAll",size:B?"100":"300",weight:"bold",children:k})})}),(0,d.jsx)(o.az,{alignSelf:I?"center":"start","data-test-id":"PinBetterSaveButton",flex:"none",marginStart:"auto",children:(0,d.jsx)(o.PF,{ref:w,color:m?"secondary":"primary",onClick:({event:e})=>{u?_(e):h(e)},selected:p,size:B?"sm":"lg",text:j})}),!!v&&!!w.current&&I&&v(w.current)]})}},443400(e,t,a){a.d(t,{A:()=>u});var s=a(97407),i=a(296540),o=a(236507),n=a(632321),l=a(55268),r=a(643357),d=a(327467),c=a(474848);function u({boardName:e,boardUrl:t,isBoardlessPin:a,isFromPinBuilder:u,hasNewPin:p,onChangeButtonClick:_,onVisitButtonClick:h=()=>{},onHide:m,onUndo:v,pinImageUrl:f}){let g;(0,i.useEffect)(()=>{(0,s.A)("PostSavedPinToast","/app/www/common/PinBetterSave/PostSavedPinToast.tsx")},[]);let S=(0,r.A)(),{logContextEvent:b}=(0,n.o)();u?g={accessibilityLabel:S.bt("Visit Pin", "Visit Pin", "PostSavedPinToast.a11yVisitButton", undefined, true),label:S.bt("Visit", "Visit", "PostSavedPinToast.VisitButton", undefined, true),size:"lg",onClick:h}:(_||v)&&(g={accessibilityLabel:p&&a&&_?S.bt("Change Pin destination", "Change Pin destination", "PostSavedPinToast.a11yChangeButton", undefined, true):S.bt("Undo saved Pin", "Undo Saved Pin", "PostSavedPinToast.a11yUndoButton", undefined, true),label:p&&a&&_?S.bt("Change", "Change", "PostSavedPinToast.ChangeButton", undefined, true):S.bt("Undo", "Undo", "PostSavedPinToast.UndoButton", undefined, true),size:"lg",onClick:p&&a&&_?()=>_():v});let P=()=>{p&&a&&_&&b({event_type:101,component:14409})};return(0,c.jsx)(l.A,{duration:a?6e3:3e3,imageUrl:f,onHide:m,primaryAction:g,text:(0,c.jsx)(o.KJ,{overflow:"normal",size:"200",children:(0,d.$w)({text:S.bt("Saved to <a id=\"1\">{{ boardName }}</a>", "Saved to <a id=\"1\">{{ boardName }}</a>", "PostSavedPinToast.SavedToBoardToast.Message", undefined, true),markers:{boardName:e??""},jsxReplacements:{1:({innerHtmlStrings:e})=>(0,c.jsx)(o.N_,{display:"block",href:a?"/me/":t??"",onClick:P,children:(0,c.jsx)(o.KJ,{lineClamp:1,size:"200",weight:"bold",children:e},"PostSavedPinToastBoardName")})}})}),thumbnail:a?{icon:(0,c.jsx)(o.In,{accessibilityLabel:S.bt("Saved to profile thumbnail", "Saved to profile thumbnail", "PostSavedPinToast.thumbnail.accessibilityLabel", undefined, true),color:"default",icon:"clock-history",size:24})}:void 0})}},580072(e,t,a){a.d(t,{A:()=>s});function s(e,t){e&&e.includes("~0")&&(e=e.replace("~0",""));let a=t?.includes("~0")?t:`${t||""}~0`;return e&&e.replace("undefined","")?e:a.replace("undefined","")}},584733(e,t,a){function s(e,t){return{type:"CHANGE_CAROUSEL_SLOT_INDEX",payload:{id:e,index:t}}}function i(e,t){return{type:"SET_PIN_COMMENTS_DISABLED",payload:{id:e,pinCommentsDisabled:t}}}function o(e){return{type:"PIN_SAVE",payload:e}}function n(e,t){return{type:"PIN_UNSAVE",payload:{id:e,nodeId:t}}}function l(e){return{type:"PIN_SHOW_SUGGESTED_CREATOR_RECS",payload:{id:e,value:!0}}}function r({id:e,nodeId:t}){return{type:"PIN_SHOW_FEEDBACK",payload:{id:e,value:!1,nodeId:t}}}function d({id:e,text:t,nodeId:a}){return{type:"PIN_SHOW_FEEDBACK",payload:{id:e,value:!0,text:t,nodeId:a}}}function c({id:e,nodeId:t}){return{type:"PIN_SHOW_FEEDBACK_OVERLAY",payload:{id:e,value:!0,nodeId:t}}}function u({id:e,nodeId:t}){return{type:"PIN_SHOW_FEEDBACK_OVERLAY",payload:{id:e,value:!1,nodeId:t}}}function p(e){return{type:"PIN_SHOW_FEWER_WEIGHT_LOSS_ADS_MODAL",payload:{id:e,value:!0}}}function _(e){return{payload:{id:e,value:!1},type:"PIN_SHOW_FEWER_WEIGHT_LOSS_ADS_MODAL"}}a.d(t,{C4:()=>i,H8:()=>r,J4:()=>o,N6:()=>p,NE:()=>_,WG:()=>c,aP:()=>n,aq:()=>d,bd:()=>u,p8:()=>s,qJ:()=>l})},375114(e,t,a){a.d(t,{Bt:()=>c,Fq:()=>p,LR:()=>o,Wi:()=>_,oH:()=>u,om:()=>d,pV:()=>n,yX:()=>l});var s=a(901856),i=a(534907);function o(e){return{type:"UPDATE_USER_PIN_COUNT",payload:e}}let n=(e,t)=>({type:"USER_FOLLOW",payload:{id:e,value:t}}),l=(e,t)=>({type:"USER_FOLLOWING_COUNT",payload:{id:e,following:t}}),r=(e,t)=>({type:"USER_BLOCK",payload:{id:e,value:t}}),d=({id:e,orbacSubjectId:t,blockSource:a,blockContext:i,logContextEvent:o})=>async n=>{n(r(e,!0));let l=await (0,s.A)({url:"/v3/users/{blocked_user}/block/",urlParams:{blocked_user:e},method:"PUT",data:{orbac_subject_id:t,block_source:a,block_context:i}}).catch(()=>n(r(e,!1)));return o({event_type:54,object_id_str:e}),l},c=(e,t)=>async a=>{a(r(e,!1));let i=await (0,s.A)({url:"/v3/users/{blocked_user}/block/",urlParams:{blocked_user:e},method:"DELETE"}).catch(()=>a(r(e,!0)));return t({event_type:55,object_id_str:e}),i};function u(e){return{type:"UPDATE_USER_SCHEDULED_PIN_COUNT",payload:e}}let p=(e,t)=>()=>(0,s.A)({url:"/v3/users/state/{state}/",urlParams:{state:e},method:"PUT",data:{value:t}}),_=(e,t,a)=>(o,n)=>{(0,s.A)({url:"/v3/users/me/",method:"POST"}).then(()=>{a({event_type:48,object_id_str:n().session.userId}),e(),(0,i.A)()},t)}},62923(e,t,a){a.d(t,{a:()=>F});var s,i,o=a(97407),n=a(296540),l=a(671468);a(234784);var r=a(278106),d=a(684059),c=a(150403),u=a(632321),p=a(555491),_=a(696561),h=a(72201),m=a(55268),v=a(449798),f=a(698781),g=a(652965),S=a(643357),b=a(581818),P=a(211974),y=a(219843),A=a(367863),C=a(703613),w=a(580072),x=a(582301),k=a(209922),I=a(584733),E=a(375114),T=a(236507),B=a(327467),R=a(67977),z=a(474848),D=a(109968);function j(e,t,a){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var s=a.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:s+"")in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}let O=/#[^(\-\\.\s#,\/$%\^&\*;:{}=\`~()\[\]@|<>â€¦)]+/gi,N=(void 0!==s||(s=a(935850)).hash&&"64132b88edd48497e63c9ad85ae5ab66"!==s.hash&&console.error("The definition of 'PinSaveRequest_pin' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),s),L=(void 0!==i||(i=a(583215)).hash&&"58c24e25a76e7a1c4533f3b07f490517"!==i.hash&&console.error("The definition of 'PinSaveRequest_shuffle_asset' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),i);class U extends n.Component{constructor(...e){super(...e),j(this,"state",{boardSavedTo:null,displaySuccessAnimation:!1,newPin:null,modalTitle:this.getModalTitle(this.props.showCreate,!!this.props.boardWithSection),pinDescription:this.props.pin&&this.props.pin.description||this.props.urlPinInfo?.description||"",resolve:void 0,sharing:{facebook:!1,twitter:!1}}),j(this,"unmounted",!1),j(this,"setModalTitle",e=>this.safeSetState({modalTitle:e})),j(this,"updateDescription",e=>{this.safeSetState({pinDescription:e})}),j(this,"close",()=>{let{onClose:e}=this.props;e&&e(),this.props.logContextEvent({event_type:2502,component:5,element:610})}),j(this,"safeSetState",(e,t)=>{this.unmounted?t&&t():this.setState(e,t)}),j(this,"getPinResource",(e,t,a)=>{let{color:s,clientTrackingParams:i,currentHistoryStack:o,pin:n,method:l,guid:r,additionalCreateFields:u,advertiser_id:p,urlPinInfo:_,shuffleAsset:h,viewerUserId:m}=this.props,v=n?.entityId?"RepinResource":"PinResource",f=n?.imageUrl||_?.imageUrl,g=n?.link||_?.link,S=!n?.entityId&&f?(0,y.A)(f,g):n?.images_orig?.url||"",{trafficSource:b}=(0,c.A)(o??[],!!m),P={...u,board_id:t||"",color:s||"",clientTrackingParams:(0,w.A)(i,n?.trackingParams),description:this.state.pinDescription,guid:r||"",link:g,image_base64:n?.imageBase64??void 0,image_url:S,is_buyable_pin:!1,is_removable:n?.promotedIsRemovable??void 0,media_upload_id:n?.mediaUploadId??void 0,method:l||"",pin_id:n?.entityId||"",section:a,title:n?.title||"",aux_data:{source:b},...p?{advertiser_id:p}:Object.freeze({}),...h?{shuffle_asset:h.entityId}:{}};if(!e){let{facebook:e,twitter:t}=this.state.sharing;P.share_facebook=e,P.share_twitter=t}return d.A.create(v,P)}),j(this,"triggerPubSubs",e=>{this.props.onPinCreate&&this.props.onPinCreate({boardId:e.board.id,pinId:e.id})}),j(this,"makeCancelablePromise",e=>{let t=!1;return{promise:new Promise((a,s)=>{e.then(e=>t?s({isCanceled:!0}):a(e)),e.catch(e=>t?s({isCanceled:!0}):s(e))}),cancel(){t=!0}}}),j(this,"handleLogToastClick",()=>{this.props.logContextEvent({event_type:101,component:20,view_type:52})}),j(this,"showBoardSavedToast",(e,t)=>{let{toastManagerContext:a,i18n:s}=this.props;a.showToast(({hideToast:a})=>{var i;return(0,z.jsx)(m.A,{duration:4e3,href:t?`${e.url??""}${t.slug??""}`:e.url,imageUrl:e.image_cover_url??"",onClick:this.handleLogToastClick,onHide:a,text:(i=e.name,t?(0,R.A)(s.bt("Saved to {{sectionName}} in {{boardName}}", "Saved to {{sectionName}} in {{boardName}}", "Toast for successfully saving to a section within a board", undefined, true),{sectionName:t.title??"",boardName:i??""}):(0,z.jsx)(T.KJ,{children:(0,B.$w)({text:s.bt("Saved to <strong id=\"1\">{{ boardName }}</strong>", "Saved to <strong id=\"1\">{{ boardName }}</strong>", "PinToBoard.Lib.SavedToBoardToast.Message", undefined, true),markers:{boardName:i??""},jsxReplacements:{1:({innerHtmlStrings:e})=>(0,z.jsx)(T.KJ,{weight:"bold",children:e})}})}))})})}),j(this,"dismissModal",()=>{let{resolve:e,newPin:t}=this.state;e&&e(t)}),j(this,"handleBoardSaveSuccess",(e,t,a,s)=>{let{action:i,saveToBoard:o,dispatch:n,pin:l,setCompletionPromise:r,shouldShowToast:d,showRepinAnimation:c,viewerUserId:u,urlPinInfo:p}=this.props;n((0,h.$O)());let _=e.resource_response.data,m=this.makeCancelablePromise(new Promise(e=>{this.triggerPubSubs(_);let i=this.state.pinDescription.match(O)||[];i.length>0&&this.props.logContextEvent({event_type:2,element:10273,object_id_str:this.props.pin?.entityId,aux_data:{hashtags:JSON.stringify(i)}});let o=()=>{d&&this.showBoardSavedToast(t,a),this.safeSetState({displaySuccessAnimation:!0,modalTitle:this.props.i18n.bt("Board created", "Board created", "Modal title after creating a new board", undefined, true),newPin:_,resolve:e})};s?o():e(_)}));!s&&l?.entityId&&c(l.entityId),r(m),o(t),n((0,k.zY)({boardId:t.id,sectionId:a&&a.id,increment:1})),u&&(n((0,E.LR)({userId:u,increment:1})),n((0,h.$O)())),(a||!t.image_cover_url)&&(t.image_cover_url=l?.imageUrl||p?.imageUrl||l?.images_236x?.url||"",n((0,k.NQ)(t))),a&&n((0,b.J)("BoardSectionResource",{options:{field_set_key:"board_page",section_id:a.id}})),l?.entityId&&n((0,I.J4)({id:l.entityId,nodeId:l.__id,boardId:t.id,title:t.name??"",url:t.url??"",localPinId:_.id}))}),j(this,"handleSaveToBoard",(e,t,a)=>{let{onToggleModal:s,shouldShowToast:i,mountAfterActionPlacement:o}=this.props;i&&!a&&(this.close(),this.showBoardSavedToast(e,t));let n="secret"===(e.privacy||""),l={board:t?t.id:e.id,state:D.J.LOADING};this.safeSetState({boardSavedTo:l},()=>{this.getPinResource(n,e.id,(t||{}).id).callCreate({showError:!1}).then(i=>{o("Save",{pin_id:this.props.pin?.entityId,is_promoted:this.props.pin?.isPromoted}),this.safeSetState({boardSavedTo:Object.assign(l,{state:D.J.SUCCESS})},()=>this.handleBoardSaveSuccess(i,e,t,a)),s&&!a&&s(!1)}).catch(e=>{this.unmounted||this.safeSetState({boardSavedTo:null}),p.A.showError(e.message_detail||e.message);let t=this.makeCancelablePromise(Promise.reject(e));this.props.setCompletionPromise(t),s&&s(!1)})})}),j(this,"handleNewBoardAnimationCompletion",()=>{let{pin:e,showRepinAnimation:t}=this.props;e?.entityId&&t(e.entityId)})}getModalTitle(e,t){if(e)if(t)return this.props.i18n.bt("Create section", "Create section", "modal title for create section pane", undefined, true);else return this.props.i18n.bt("Create board", "Create board", "Repin title for making a new board", undefined, true);return t?this.props.i18n.bt("Choose section", "Choose section", "modal title for choose section", undefined, true):this.props.i18n.bt("Choose board", "Choose board", "Repin title for choosing a board", undefined, true)}componentDidUpdate(e){let{boardWithSection:t,showCreate:a,pin:s,urlPinInfo:i,description:o}=this.props,n={};(s!==e.pin||i!==e.urlPinInfo||o!==e.description)&&(n.pinDescription=s?.description||i?.description||o||""),(a!==e.showCreate||t!==e.boardWithSection)&&(n.modalTitle=this.getModalTitle(a,!!t)),Object.keys(n).length>0&&this.safeSetState(n)}componentWillUnmount(){this.unmounted=!0}render(){let{close:e,dismissModal:t,handleNewBoardAnimationCompletion:a,handleSaveToBoard:s,setModalTitle:i,updateDescription:o}=this,{boardSavedTo:n,displaySuccessAnimation:l,modalTitle:r,newPin:d}=this.state,{color:c}=this.props;return this.props.children({boardSavedTo:n,color:c,dismissModal:t,displaySuccessAnimation:l,handleAbort:e,handleNewBoardAnimationCompletion:a,handleSaveToBoard:s,modalTitle:r,newPin:d,setModalTitle:i,updateDescription:o})}componentDidMount(){(0,o.A)("PinSaveRequest","/app/www/save/pin-to-board/PinSaveRequest.tsx")}}function F({pinKey:e,shuffleAssetKey:t,...a}){(0,n.useEffect)(()=>{(0,o.A)("PinSaveRequest","/app/www/save/pin-to-board/PinSaveRequest.tsx")},[]);let{saveToBoard:s}=(0,C.p)(),{logContextEvent:i}=(0,u.o)(),d=(0,x.y)()?.onPinCreate,c=(0,S.A)(),p=(0,r.zy)(),h=(0,v.A)(),m=(0,P.CG)(),b=(0,l.wA)(),{updateHeaderState:y}=(0,A.A)(),w=(0,l.d4)(({advertiser:e})=>h.isAuth&&e&&e.owner_user_id!==h.id?e.id:void 0),{previous:k}=(0,g.qD)(),I=(0,_.Ts)(),E=(0,g.V)(),T=(0,f.A)(N,e),B=(0,f.A)(L,t);return(0,z.jsx)(U,{...a,advertiser_id:w,currentHistoryStack:E,dispatch:b,i18n:c,location:p,logContextEvent:i,mountAfterActionPlacement:I,onPinCreate:d,pin:T,previousHistory:k,saveToBoard:s,showRepinAnimation:e=>y({type:"showRepinAnimation",payload:e}),shuffleAsset:B,toastManagerContext:m,viewerUserId:h.isAuth?h.id:void 0})}},109968(e,t,a){a.d(t,{J:()=>s});let s={LOADING:"loading",SUCCESS:"success"}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/99298.en_GB-7725ef9cfe557e55.mjs.map